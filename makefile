CC = gcc
CFLAGS = -g -Wall -Wextra -ISDL2/include/SDL2 -D_REENTRANT
LDFLAGS = -I include -LSDL2/lib -Wl,-rpath,SDL2/lib -Wl,--enable-new-dtags -lSDL2
ARCHIVE = makefile doc/Doxyfile include/* src/* level/* README.md Screenshots/* SDL2_installation.zip
OPATH = obj/
CPATH = src/
IPATH = include/
BPATH = bin/

# Cette partie permet de determiner la moiti√© de nombre de CPUs selon le systeme Linux ou MacOS
NPROCS:=1
CURRENTDIR:=$(shell pwd | rev | cut -f1 -d'/' | rev)
OS:=$(shell uname -s)
ifeq ($(OS),Linux)
  NPROCS:=$(shell grep -c ^processor /proc/cpuinfo | awk '{print $$1/2}')
endif
ifeq ($(OS),Darwin)
  NPROCS:=$(shell system_profiler | awk '/Number Of CPUs/{print $$4 / 2}{next;}')
endif

# montrer les differentes commandes disponibles de makefile
.PHONY: help main clean docs archive jeu

# les chemins vers les differents dossiers
vpath %.h $(IPATH)
vpath %.c $(CPATH)
vpath %.o $(OPATH)

# les fichiers sources necessaires pour main
SRC = $(OPATH)grid.o $(OPATH)display.o $(OPATH)player.o $(OPATH)sdl2.o $(OPATH)event.o

# l'executable main
OBJ = $(OPATH)main.o

$(OPATH)%.o: %.c
	mkdir -p $(OPATH)
	$(CC) -c $< $(CFLAGS) $(LDFLAGS)
	mv *.o $(OPATH)

# compilation de sokoban
main:
	# permet d'installer la librairie SDL2 si elle n'existe pas
	if [ ! -d SDL2 ]; then unzip -q SDL2_installation.zip && cd SDL2_installation/ && ./configure --prefix=$(PWD)/SDL2/ && make install -j$(NPROCS)  &&  cd ../ && rm -rf SDL2_installation; fi
	mkdir -p $(BPATH)
	$(CC) -o $@ $(CPATH)main.c $(CPATH)grid.c $(CPATH)display.c $(CPATH)player.c $(CPATH)sdl2.c $(CPATH)event.c $(CFLAGS) $(LDFLAGS)
	mv -f $@ $(BPATH)
	@echo "Debut de compilation de 'main.c' ..."
	@echo " "
	@echo "		[5m[38;5;33m [5m[0m[5m[38;5;33m_[5m[0m[5m[38;5;39m_[5m[0m[5m[38;5;39m_[5m[0m[5m[38;5;39m_[5m[0m[5m[38;5;38m_[5m[0m[5m[38;5;44m_[5m[0m[5m[38;5;44m_[5m[0m[5m[38;5;44m_[5m[0m[5m[38;5;43m_[5m[0m[5m[38;5;49m_[5m[0m[5m[38;5;49m_[5m[0m[5m[38;5;49m_[5m[0m[5m[38;5;48m_[5m[0m[5m[38;5;48m_[5m[0m[5m[38;5;48m_[5m[0m[5m[38;5;83m_[5m[0m[5m[38;5;83m_[5m[0m[5m[38;5;83m_[5m[0m[5m[38;5;83m_[5m[0m[5m[38;5;118m_[5m[0m[5m[38;5;118m_[5m[0m[5m[38;5;118m_[5m[0m[5m[38;5;154m_[5m[0m[5m[38;5;154m_[5m[0m[5m[38;5;154m_[5m[0m[5m[38;5;148m_[5m[0m[5m[38;5;184m_[5m[0m[5m[38;5;184m_[5m[0m[5m[38;5;184m_[5m[0m[5m[38;5;178m_[5m[0m[5m[38;5;214m_[5m[0m[5m[38;5;214m_[5m[0m[5m[38;5;214m_[5m[0m[5m[38;5;208m_[5m[0m"
	@echo "		[5m[38;5;33m<[5m[0m[5m[38;5;39m [5m[0m[5m[38;5;39mC[5m[0m[5m[38;5;39mo[5m[0m[5m[38;5;38mm[5m[0m[5m[38;5;44mp[5m[0m[5m[38;5;44mi[5m[0m[5m[38;5;44ml[5m[0m[5m[38;5;43ma[5m[0m[5m[38;5;49mt[5m[0m[5m[38;5;49mi[5m[0m[5m[38;5;49mo[5m[0m[5m[38;5;48mn[5m[0m[5m[38;5;48m [5m[0m[5m[38;5;48mr[5m[0m[5m[38;5;83me[5m[0m[5m[38;5;83mu[5m[0m[5m[38;5;83ms[5m[0m[5m[38;5;83ms[5m[0m[5m[38;5;118mi[5m[0m[5m[38;5;118me[5m[0m[5m[38;5;118m [5m[0m[5m[38;5;154m![5m[0m[5m[38;5;154m [5m[0m[5m[38;5;154mM[5m[0m[5m[38;5;148mo[5m[0m[5m[38;5;184mo[5m[0m[5m[38;5;184mo[5m[0m[5m[38;5;184mo[5m[0m[5m[38;5;178mu[5m[0m[5m[38;5;214mu[5m[0m[5m[38;5;214m.[5m[0m[5m[38;5;214m.[5m[0m[5m[38;5;208m.[5m[0m[5m[38;5;208m [5m[0m[5m[38;5;208m>[5m[0m"
	@echo "		[5m[38;5;39m [5m[0m[5m[38;5;39m-[5m[0m[5m[38;5;39m-[5m[0m[5m[38;5;38m-[5m[0m[5m[38;5;44m-[5m[0m[5m[38;5;44m-[5m[0m[5m[38;5;44m-[5m[0m[5m[38;5;43m-[5m[0m[5m[38;5;49m-[5m[0m[5m[38;5;49m-[5m[0m[5m[38;5;49m-[5m[0m[5m[38;5;48m-[5m[0m[5m[38;5;48m-[5m[0m[5m[38;5;48m-[5m[0m[5m[38;5;83m-[5m[0m[5m[38;5;83m-[5m[0m[5m[38;5;83m-[5m[0m[5m[38;5;83m-[5m[0m[5m[38;5;118m-[5m[0m[5m[38;5;118m-[5m[0m[5m[38;5;118m-[5m[0m[5m[38;5;154m-[5m[0m[5m[38;5;154m-[5m[0m[5m[38;5;154m-[5m[0m[5m[38;5;148m-[5m[0m[5m[38;5;184m-[5m[0m[5m[38;5;184m-[5m[0m[5m[38;5;184m-[5m[0m[5m[38;5;178m-[5m[0m[5m[38;5;214m-[5m[0m[5m[38;5;214m-[5m[0m[5m[38;5;214m-[5m[0m[5m[38;5;208m-[5m[0m[5m[38;5;208m-[5m[0m[5m[38;5;208m-[5m[0m"
	@echo "		[5m[38;5;39m [5m[0m[5m[38;5;39m [5m[0m[5m[38;5;38m [5m[0m[5m[38;5;44m [5m[0m[5m[38;5;44m [5m[0m[5m[38;5;44m [5m[0m[5m[38;5;43m [5m[0m[5m[38;5;49m [5m[0m[5m[38;5;49m\[5m[0m[5m[38;5;49m [5m[0m[5m[38;5;48m [5m[0m[5m[38;5;48m [5m[0m[5m[38;5;48m^[5m[0m[5m[38;5;83m_[5m[0m[5m[38;5;83m_[5m[0m[5m[38;5;83m^[5m[0m"
	@echo "		[5m[38;5;39m [5m[0m[5m[38;5;38m [5m[0m[5m[38;5;44m [5m[0m[5m[38;5;44m [5m[0m[5m[38;5;44m [5m[0m[5m[38;5;43m [5m[0m[5m[38;5;49m [5m[0m[5m[38;5;49m [5m[0m[5m[38;5;49m [5m[0m[5m[38;5;48m\[5m[0m[5m[38;5;48m [5m[0m[5m[38;5;48m [5m[0m[5m[38;5;83m([5m[0m[5m[38;5;83mo[5m[0m[5m[38;5;83mo[5m[0m[5m[38;5;83m)[5m[0m[5m[38;5;118m\[5m[0m[5m[38;5;118m_[5m[0m[5m[38;5;118m_[5m[0m[5m[38;5;154m_[5m[0m[5m[38;5;154m_[5m[0m[5m[38;5;154m_[5m[0m[5m[38;5;148m_[5m[0m[5m[38;5;184m_[5m[0m"
	@echo "		[5m[38;5;38m [5m[0m[5m[38;5;44m [5m[0m[5m[38;5;44m [5m[0m[5m[38;5;44m [5m[0m[5m[38;5;43m [5m[0m[5m[38;5;49m [5m[0m[5m[38;5;49m [5m[0m[5m[38;5;49m [5m[0m[5m[38;5;48m [5m[0m[5m[38;5;48m [5m[0m[5m[38;5;48m [5m[0m[5m[38;5;83m [5m[0m[5m[38;5;83m([5m[0m[5m[38;5;83m_[5m[0m[5m[38;5;83m_[5m[0m[5m[38;5;118m)[5m[0m[5m[38;5;118m\[5m[0m[5m[38;5;118m [5m[0m[5m[38;5;154m [5m[0m[5m[38;5;154m [5m[0m[5m[38;5;154m [5m[0m[5m[38;5;148m [5m[0m[5m[38;5;184m [5m[0m[5m[38;5;184m [5m[0m[5m[38;5;184m)[5m[0m[5m[38;5;178m\[5m[0m[5m[38;5;214m/[5m[0m[5m[38;5;214m\[5m[0m"
	@echo "		[5m[38;5;44m [5m[0m[5m[38;5;44m [5m[0m[5m[38;5;44m [5m[0m[5m[38;5;43m [5m[0m[5m[38;5;49m [5m[0m[5m[38;5;49m [5m[0m[5m[38;5;49m [5m[0m[5m[38;5;48m [5m[0m[5m[38;5;48m [5m[0m[5m[38;5;48m [5m[0m[5m[38;5;83m [5m[0m[5m[38;5;83m [5m[0m[5m[38;5;83m [5m[0m[5m[38;5;83m [5m[0m[5m[38;5;118m [5m[0m[5m[38;5;118m [5m[0m[5m[38;5;118m|[5m[0m[5m[38;5;154m|[5m[0m[5m[38;5;154m-[5m[0m[5m[38;5;154m-[5m[0m[5m[38;5;148m-[5m[0m[5m[38;5;184m-[5m[0m[5m[38;5;184mw[5m[0m[5m[38;5;184m [5m[0m[5m[38;5;178m|[5m[0m"
	@echo "		[5m[38;5;44m [5m[0m[5m[38;5;44m [5m[0m[5m[38;5;43m [5m[0m[5m[38;5;49m [5m[0m[5m[38;5;49m [5m[0m[5m[38;5;49m [5m[0m[5m[38;5;48m [5m[0m[5m[38;5;48m [5m[0m[5m[38;5;48m [5m[0m[5m[38;5;83m [5m[0m[5m[38;5;83m [5m[0m[5m[38;5;83m [5m[0m[5m[38;5;83m [5m[0m[5m[38;5;118m [5m[0m[5m[38;5;118m [5m[0m[5m[38;5;118m [5m[0m[5m[38;5;154m|[5m[0m[5m[38;5;154m|[5m[0m[5m[38;5;154m [5m[0m[5m[38;5;148m [5m[0m[5m[38;5;184m [5m[0m[5m[38;5;184m [5m[0m[5m[38;5;184m [5m[0m[5m[38;5;178m|[5m[0m[5m[38;5;214m|[5m[0m"
	@echo " "

# affiche l'aide du jeu
help:
	@echo "					----------------"
	@echo "					| Help section |"
	@echo "					----------------"
	@echo ""
	@echo "        Ce code est un jeu de Sokoban fait en C."
	@echo ""
	@echo "               Usage: make [command]"
	@echo ""
	@echo "        Available commands: "
	@echo "        		help: Display this help."
	@echo "        		main: Compiler le code source de Sokoban."
	@echo "        		clean: Nettoyer les fichiers temporaires."
	@echo "        		docs: Genere la documentation du jeu."
	@echo "        		archive: Genere une archive"
	@echo "        		jeu: comment jouer Sokoban"
	@echo ""
	@echo "   [5m[38;5;184m [5m[0m[5m[38;5;178m_[5m[0m[5m[38;5;214m_[5m[0m[5m[38;5;214m_[5m[0m[5m[38;5;214m_[5m[0m[5m[38;5;208m_[5m[0m[5m[38;5;208m_[5m[0m[5m[38;5;208m_[5m[0m[5m[38;5;203m_[5m[0m[5m[38;5;203m_[5m[0m[5m[38;5;203m_[5m[0m[5m[38;5;203m_[5m[0m[5m[38;5;198m_[5m[0m[5m[38;5;198m_[5m[0m[5m[38;5;198m_[5m[0m[5m[38;5;199m_[5m[0m[5m[38;5;199m_[5m[0m[5m[38;5;199m_[5m[0m[5m[38;5;163m_[5m[0m[5m[38;5;164m_[5m[0m[5m[38;5;164m_[5m[0m[5m[38;5;164m_[5m[0m[5m[38;5;128m_[5m[0m[5m[38;5;129m_[5m[0m[5m[38;5;129m_[5m[0m[5m[38;5;129m_[5m[0m[5m[38;5;93m_[5m[0m[5m[38;5;93m_[5m[0m[5m[38;5;93m_[5m[0m[5m[38;5;63m_[5m[0m[5m[38;5;63m_[5m[0m[5m[38;5;63m_[5m[0m[5m[38;5;63m_[5m[0m[5m[38;5;33m_[5m[0m[5m[38;5;33m_[5m[0m[5m[38;5;33m_[5m[0m[5m[38;5;39m_[5m[0m[5m[38;5;39m_[5m[0m[5m[38;5;39m_[5m[0m[5m[38;5;38m_[5m[0m[5m[38;5;44m_[5m[0m"
	@echo "   [5m[38;5;178m<[5m[0m[5m[38;5;214m [5m[0m[5m[38;5;214mC[5m[0m[5m[38;5;214mo[5m[0m[5m[38;5;208mm[5m[0m[5m[38;5;208mm[5m[0m[5m[38;5;208me[5m[0m[5m[38;5;203mn[5m[0m[5m[38;5;203mt[5m[0m[5m[38;5;203m [5m[0m[5m[38;5;203mp[5m[0m[5m[38;5;198mu[5m[0m[5m[38;5;198mi[5m[0m[5m[38;5;198ms[5m[0m[5m[38;5;199m-[5m[0m[5m[38;5;199mj[5m[0m[5m[38;5;199me[5m[0m[5m[38;5;163m [5m[0m[5m[38;5;164mv[5m[0m[5m[38;5;164mo[5m[0m[5m[38;5;164mu[5m[0m[5m[38;5;128ms[5m[0m[5m[38;5;129m [5m[0m[5m[38;5;129ma[5m[0m[5m[38;5;129mi[5m[0m[5m[38;5;93md[5m[0m[5m[38;5;93me[5m[0m[5m[38;5;93mr[5m[0m[5m[38;5;63m?[5m[0m[5m[38;5;63m [5m[0m[5m[38;5;63mM[5m[0m[5m[38;5;63mo[5m[0m[5m[38;5;33mo[5m[0m[5m[38;5;33mo[5m[0m[5m[38;5;33mo[5m[0m[5m[38;5;39mu[5m[0m[5m[38;5;39mu[5m[0m[5m[38;5;39m.[5m[0m[5m[38;5;38m.[5m[0m[5m[38;5;44m.[5m[0m[5m[38;5;44m [5m[0m[5m[38;5;44m>[5m[0m"
	@echo "   [5m[38;5;214m [5m[0m[5m[38;5;214m-[5m[0m[5m[38;5;214m-[5m[0m[5m[38;5;208m-[5m[0m[5m[38;5;208m-[5m[0m[5m[38;5;208m-[5m[0m[5m[38;5;203m-[5m[0m[5m[38;5;203m-[5m[0m[5m[38;5;203m-[5m[0m[5m[38;5;203m-[5m[0m[5m[38;5;198m-[5m[0m[5m[38;5;198m-[5m[0m[5m[38;5;198m-[5m[0m[5m[38;5;199m-[5m[0m[5m[38;5;199m-[5m[0m[5m[38;5;199m-[5m[0m[5m[38;5;163m-[5m[0m[5m[38;5;164m-[5m[0m[5m[38;5;164m-[5m[0m[5m[38;5;164m-[5m[0m[5m[38;5;128m-[5m[0m[5m[38;5;129m-[5m[0m[5m[38;5;129m-[5m[0m[5m[38;5;129m-[5m[0m[5m[38;5;93m-[5m[0m[5m[38;5;93m-[5m[0m[5m[38;5;93m-[5m[0m[5m[38;5;63m-[5m[0m[5m[38;5;63m-[5m[0m[5m[38;5;63m-[5m[0m[5m[38;5;63m-[5m[0m[5m[38;5;33m-[5m[0m[5m[38;5;33m-[5m[0m[5m[38;5;33m-[5m[0m[5m[38;5;39m-[5m[0m[5m[38;5;39m-[5m[0m[5m[38;5;39m-[5m[0m[5m[38;5;38m-[5m[0m[5m[38;5;44m-[5m[0m[5m[38;5;44m-[5m[0m[5m[38;5;44m-[5m[0m"
	@echo "   [5m[38;5;214m [5m[0m[5m[38;5;214m [5m[0m[5m[38;5;208m [5m[0m[5m[38;5;208m [5m[0m[5m[38;5;208m [5m[0m[5m[38;5;203m [5m[0m[5m[38;5;203m [5m[0m[5m[38;5;203m [5m[0m[5m[38;5;203m\[5m[0m[5m[38;5;198m [5m[0m[5m[38;5;198m [5m[0m[5m[38;5;198m [5m[0m[5m[38;5;199m^[5m[0m[5m[38;5;199m_[5m[0m[5m[38;5;199m_[5m[0m[5m[38;5;163m^[5m[0m"
	@echo "   [5m[38;5;214m [5m[0m[5m[38;5;208m [5m[0m[5m[38;5;208m [5m[0m[5m[38;5;208m [5m[0m[5m[38;5;203m [5m[0m[5m[38;5;203m [5m[0m[5m[38;5;203m [5m[0m[5m[38;5;203m [5m[0m[5m[38;5;198m [5m[0m[5m[38;5;198m\[5m[0m[5m[38;5;198m [5m[0m[5m[38;5;199m [5m[0m[5m[38;5;199m([5m[0m[5m[38;5;199mo[5m[0m[5m[38;5;163mo[5m[0m[5m[38;5;164m)[5m[0m[5m[38;5;164m\[5m[0m[5m[38;5;164m_[5m[0m[5m[38;5;128m_[5m[0m[5m[38;5;129m_[5m[0m[5m[38;5;129m_[5m[0m[5m[38;5;129m_[5m[0m[5m[38;5;93m_[5m[0m[5m[38;5;93m_[5m[0m"
	@echo "   [5m[38;5;208m [5m[0m[5m[38;5;208m [5m[0m[5m[38;5;208m [5m[0m[5m[38;5;203m [5m[0m[5m[38;5;203m [5m[0m[5m[38;5;203m [5m[0m[5m[38;5;203m [5m[0m[5m[38;5;198m [5m[0m[5m[38;5;198m [5m[0m[5m[38;5;198m [5m[0m[5m[38;5;199m [5m[0m[5m[38;5;199m [5m[0m[5m[38;5;199m([5m[0m[5m[38;5;163m_[5m[0m[5m[38;5;164m_[5m[0m[5m[38;5;164m)[5m[0m[5m[38;5;164m\[5m[0m[5m[38;5;128m [5m[0m[5m[38;5;129m [5m[0m[5m[38;5;129m [5m[0m[5m[38;5;129m [5m[0m[5m[38;5;93m [5m[0m[5m[38;5;93m [5m[0m[5m[38;5;93m [5m[0m[5m[38;5;63m)[5m[0m[5m[38;5;63m\[5m[0m[5m[38;5;63m/[5m[0m[5m[38;5;63m\[5m[0m"
	@echo "   [5m[38;5;208m [5m[0m[5m[38;5;208m [5m[0m[5m[38;5;203m [5m[0m[5m[38;5;203m [5m[0m[5m[38;5;203m [5m[0m[5m[38;5;203m [5m[0m[5m[38;5;198m [5m[0m[5m[38;5;198m [5m[0m[5m[38;5;198m [5m[0m[5m[38;5;199m [5m[0m[5m[38;5;199m [5m[0m[5m[38;5;199m [5m[0m[5m[38;5;163m [5m[0m[5m[38;5;164m [5m[0m[5m[38;5;164m [5m[0m[5m[38;5;164m [5m[0m[5m[38;5;128m|[5m[0m[5m[38;5;129m|[5m[0m[5m[38;5;129m-[5m[0m[5m[38;5;129m-[5m[0m[5m[38;5;93m-[5m[0m[5m[38;5;93m-[5m[0m[5m[38;5;93mw[5m[0m[5m[38;5;63m [5m[0m[5m[38;5;63m|[5m[0m"
	@echo "   [5m[38;5;208m [5m[0m[5m[38;5;203m [5m[0m[5m[38;5;203m [5m[0m[5m[38;5;203m [5m[0m[5m[38;5;203m [5m[0m[5m[38;5;198m [5m[0m[5m[38;5;198m [5m[0m[5m[38;5;198m [5m[0m[5m[38;5;199m [5m[0m[5m[38;5;199m [5m[0m[5m[38;5;199m [5m[0m[5m[38;5;163m [5m[0m[5m[38;5;164m [5m[0m[5m[38;5;164m [5m[0m[5m[38;5;164m [5m[0m[5m[38;5;128m [5m[0m[5m[38;5;129m|[5m[0m[5m[38;5;129m|[5m[0m[5m[38;5;129m [5m[0m[5m[38;5;93m [5m[0m[5m[38;5;93m [5m[0m[5m[38;5;93m [5m[0m[5m[38;5;63m [5m[0m[5m[38;5;63m|[5m[0m[5m[38;5;63m|[5m[0m"
	@echo ""

# creation de la documentation
docs:
	doxygen doc/Doxyfile
	mv html/ doc

# creation de l'archive
archive:
	make clean
	tar -cf WAZNI_Zahraa__PURSON-PASQUALINI_Zo√©.tar.gz $(ARCHIVE)

# suppression des fichiers temporaires et retour a l'etat initial
clean:
	rm -rf obj
	rm -rf bin
	rm -rf doc/html
	rm -rf SDL2 share lib include/SDL2 bin/sdl2.config WAZNI_Zahraa__PURSON-PASQUALINI_Zo√©.tar.gz
# suppression des fichiers temporaires et retour a l'etat initial
jeu:
	@echo "Mouvements:"
	@echo "Bouger a gauche: 'J'"
	@echo "Bouger a droite: 'L'"
	@echo "Bouger en bas: 'K'"
	@echo "Bouger en haut: 'I'"
	@echo "quitter le jeu: 'Q'"
